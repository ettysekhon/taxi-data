## Synchronizing Code from GitHub

Kestra can automatically sync your code from Git repositories like GitHub, keeping your workflows and scripts version-controlled and up-to-date. This enables true GitOps workflows where Git becomes your single source of truth.

### Understanding Git Sync in Kestra
Kestra offers two main approaches for syncing code from Git repositories:

#### NamespaceSync - Project-Specific Code Sync

Syncs files from a single Git directory to a specific namespace.

- **Best for:** Team-specific code, isolated projects.
- **Use when:** You want simple, focused syncing for one team/project.
- **Git structure:** Flat directory structure (e.g., `data-processing/`).
- **Scope:** Files are only available within the target namespace.
- **Example:** Your data engineering team's Python ETL scripts in `dev.testing` namespace.
- **Authentication:** Uses Git credentials only.

**When to use:** You have a simple project where all code belongs to one team/namespace.

#### TenantSync - Multi-Namespace Code Distribution

Syncs files and flows from a structured Git repository to multiple namespaces simultaneously.

- **Best for:** Organization-wide code distribution, shared utilities.
- **Use when:** You need to distribute code across multiple namespaces from a single source.
- **Git structure:** Namespace-based directory structure (e.g., `<namespace>/files/`, `<namespace>/flows/`).
- **Scope:** Syncs to ALL namespaces found in your Git repository structure.
- **Example:** Shared validation libraries in `common/files/` â†’ `common` namespace, team-specific code in `dev.testing/files/` â†’ `dev.testing` namespace.
- **Authentication:** Requires both Git credentials AND Kestra API credentials.

**When to use:** You have multiple teams/namespaces and want centralized GitOps management of all code.

> [!IMPORTANT]
> **Key Difference:** NamespaceSync is simpler and syncs one directory to one namespace. TenantSync reads your entire repository structure and creates/updates files in multiple namespaces based on the folder names. It distributes files to their respective namespaces based on your Git folder structure.

ðŸ‘‰ More info about [TenantSync and NamespaceSync](https://kestra.io/docs/version-control-cicd/git#git-tenantsync-and-namespacesync).

### Prerequisites
Before starting, ensure you have:

- A GitHub account (free account is sufficient)
- Git installed on your machine
- Your Kestra instance running with port-forwarding active

### Clone the GitHub Repository

Link to the course's GitHub Repo with all the flows and files of the course: [kestra-demo repo](https://github.com/andkret/kestra-demo)

![folder structure.](/images/kestra-git-demo-folder-structure.png)

### Store GitHub Token and User Credentials in Your Config

Use the environment file (`.env_encoded`) and add this content from the GitHub key file:
```
SECRET_GITHUB_TOKEN=[YOUR_GITHUB_PERSONAL_ACCESS_TOKEN]
SECRET_KESTRA_USER=[YOUR_KESTRA_USER]
SECRET_KESTRA_PASSWORD=[YOUR_KESTRA_PASSWORD]
```

Make sure that you use my bin64 converter to convert the plain text token, username and password to bin64:

[Link to the encder python script](https://github.com/andkret/Kestra-Workflow-Orchestration/blob/6eb202e600b18dde6cc9cd5429278456743b90b6/helper_scripts/quick_base64_encode.py)

> [!IMPORTANT]
> Do not use a conversion website! They can see your token!!!

### Set Up NamespaceSync (Project-Specific Code)
Let's sync the data-processing folder to a specific namespace.

[Link to the flow](https://github.com/andkret/kestra-demo/blob/3383d8804ca5ffc1cdd3df5a40fda2c68c1aa60d/dev.testing/flows/2_2/sync-project-code.yaml)


#### Create the TenantSync Flow
In Kestra UI, create a new flow in the `system` namespace:

[Link to the TenantSync flow](https://github.com/andkret/kestra-demo/blob/9ae8ae5d8ffdd5c560e254db4d6573ba3e0b82fa/dev.testing/flows/2_2/tenant-sync-flow.yaml)

> [!IMPORTANT]
> - Replace YOUR-USERNAME with your actual GitHub username.
> - The kestraUrl uses localhost because the task runs inside the Kubernetes cluster.

> [!IMPORTANT]
> You need to have the listed namespaces of your GitHub repo (dev.testing, common, data-processing). If you use the Open Source edition, you cannot create them via Kestra UI. However, you can run a simple flow (see Run Python Code) with the required namespace and this will generate the namespace for you.

Click "Execute".

If there were no errors, go to your namespace and check the `Files` menu. You should see the synced files (see screenshot below):

![Synced namespace files](/images/synced-tenantsync-files.png)

Now the file can be used in other flows and synced when changes happen.

ðŸ‘‰ More info about [TenantSync](https://kestra.io/plugins/plugin-git/io.kestra.plugin.git.tenantsync).
